<!DOCTYPE html>
<html>
    <head>
        <title>Shape Judgement Task</title>
        <script src="jspsych-6.0.99901/jspsych.js"></script>
        <script src="jspsych-6.0.99901/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.0.99901/plugins/jspsych-image-keyboard-response.js"></script>
        <script src="jspsych-6.0.99901/plugins/jspsych-html-slider-response.js"></script>
        <script src="jspsych-6.0.99901/plugins/jspsych-survey-text.js"></script>
        <script src="jspsych-6.0.99901/plugins/jspsych-survey-multi-choice.js"></script>
        <script src="jspsych-6.0.99901/plugins/jspsych-video.js"></script>
        <link href="jspsych-6.0.99901/css/jspsych.css" rel="stylesheet" type="text/css"></link>
        <span class="wb-sessto" data-wb-sessto='{"inactivity": 10000, "reactionTime": 30000, "sessionalive": 1200000, "logouturl": "./", "refreshCallbackUrl": "./"}'></span>
    </head>
    <body></body>
    <script>

      // create timeline
      let timeline = [];

      // welcome user
      let welcome = {

        // jspsych keys and values
        // html-keyboard-response allows user to continue via key press
        // by default user may press any key
        type: "html-keyboard-response",

        // stimulus is the text displayed on the screen, prompts user
        stimulus: "<p style='font-size:40px'>Welcome to the Study of Shape Judgment</p>"+"<p>Press the space bar to begin</p>",

        // space bar only choice
        choices: [' ']
      }

      // push object to timeline
      timeline.push(welcome);

      let consent_form = {
        type: "survey-multi-choice",
        questions: [{prompt: "<b>Online Consent Form</b>"+
        "<br>"+
        "<p>Northeastern University, Department of Psychology. Affective and Brain Science Lab</p>"+
        "<p>Name of Investigator: Ajay B. Satpute, PhD</p>"+
        "<p>Project Title: Shape Judgement<p>"+
        "<br>"+
        "<p>Thank you for volunteering for our study! You must be between the ages of 18-65, have normal or corrected-to-normal color vision and be a fluent speaker of English in order to participate. In addition, in order to work on this HIT you must have the Adult Content Qualification.</p>"
        +
        "<p>For this online study, you will be asked to watch a series of short video clips and describe what you see. You will also be asked to predict what will happen next in the videos. These videos will only consist of multiple shapes on a screen. While these images are used widely in psychology experiments, if you do not wish to be exposed to them please do not proceed with this study.</p>"
        +
        "<p>You will be asked to make simple judgments about each stimulus. These include judgments about what you think is currently happening and what you think will happen if the video continues.</p>"
        +
        "<p>The entire process may vary, but typically takes less than 1 hour.</p>"
        +
        "<p>The possible risks or discomforts of the study are minimal. You will be viewing images of shapes moving together. If you feel uncomfortable you may stop the task at any time.</p>"
        +
        "<p>You will receive $6 for completing this study.  You must complete 100% of the responses in order to receive payment.</p>"
        +
        "<p>Your part in this study is anonymous to the researcher(s). However, because of the nature of web-based surveys, it is possible that respondents could be identified by the IP address or other electronic record associated with the response. Neither the researcher nor anyone involved with this survey will be capturing those data. Any reports or publications based on this research will use only group data and will not identify you or any individual as being affiliated with this project. The only individually-identifying data we receive from Mechanical Turk are your unique identifier and your country. Your data are also stored on Mechanical Turk servers, and the data there are subject to the Amazon Mechanical Turk Privacy Notice and Participation Agreement.</p>"
        +
        "<p>If you have any questions regarding electronic privacy, please feel free to contact the Northeastern University Office of Information Security at privacy@neu.edu.</p>"
        +
        "<p>If you have any questions about the study, you can contact the experimenters (abslab.nu@gmail.com) or the Principle Investigator, Dr. Ajay Satpute (a.satpute@northeastern.edu).</p>"
        +
        "<p>This study has been reviewed and approved by the Institutional Review Board (IRB) of Northeastern University (#18-02-20).  If you have any questions regarding your rights as a research participant, please the Northeastern University Office of Human Subject Research Protection at irb@neu.edu or 617-373-4588. You may call anonymously if you wish.</p>"
        +
        "<p>Your participation is completely voluntary, and you may choose to discontinue at any time without penalty. If you prefer not to participate or to discontinue participation, simply closer the browser at any time.</p>"
        +
        "<p>By clicking 'Yes, I provide consent to participate in this study' and pressing the 'OK' button, you assert that you understand the statement given above and consent to participate in the study. Please print out a copy of this consent form for your records or contact us if you would prefer an electronic copy of the consent.</p>"
        +"<a target='_blank' rel='noopener noreferrer' href='consentform/ConsentForm.pdf'>Consent Form .pdf</a>",
        options: ['Yes, I provide consent to participate in the study', 'No, I do NOT provide consent to participate in this study'],

        // response required
        required: true}],
        button_label: 'OK',
        data: {test_part: 'consent_form'}
      }
      timeline.push(consent_form);

      let consent_response = {
        type: 'html-keyboard-response',
        stimulus: '<p>You have NOT given consent to participate in this study. You may close this page now. Thank you for your time.</p>'+
          '<b>If this was a mistake, please reload the page!<b>',

        // can't advance screen by pressing keys
        choices: jsPsych.NO_KEYS,
        trial_duration: function response_duration() {

          // get the user's response to whether or not they agree to the terms of the consent form
          let yes_or_no = jsPsych.data.get().filter({test_part: 'consent_form'}).select('responses').values[0];

          // return nothing if no consent given (trial duration is infinite)
          if (yes_or_no == '{"Q0":"No, I do NOT provide consent to participate in this study"}') {
            return;
          }

          // flash 1 millisecond screen if consent given
          return 1;
        },
        data: {test_part: 'consent_response'}
      }
      timeline.push(consent_response);

      // generate random 6 digit number
      var six_digit_random = six_digit_random();

      // assign a unique number to the participant
      let enter_participant_id = {

        type: "html-keyboard-response",

        stimulus: "<p>Thank you for participating in our study.</p>"+
          "<p>Please copy the following subject code to your Mturk task page:</p>"+six_digit_random+"<br><br>"+"<p>When you have finished, press the space bar to continue.</p>",

        choices: [' '],

        // create additional property with key "test_part" for easy access later
        data: {test_part: 'participant_id'}
      }
      timeline.push(enter_participant_id);

      let experiment_overview = {
        type: "html-keyboard-response",
        stimulus: "<p>This experiment will have 3 parts. The first and second part will be on this website. At the end of the second part, we will give you instructions and the link to complete a survey on a separate website.</p>"+"<br>"+"<p>Press the space bar to continue.</p>",
        choices: [' ']
      }
      timeline.push(experiment_overview);

      // give instructions to the arithmetic section
      let arithmetic_instructions = {
        type: "html-keyboard-response",
        stimulus: "<p>In this part of the experiment, we would like you to answer a few math questions.</p>"+
          "<p>For each question, please select one answer.</p>"+"<br>"+"<p>Press the space bar to begin.</p>",
        choices: [' ']
      }
      timeline.push(arithmetic_instructions);

      // prompt user with four simple arithmetic questions
      let arithmetic_questions = {
        type: "survey-multi-choice",

        // questions parameter is an array of prompts and options. "required" makes questions unskippable
        questions: [{prompt: "<u style='font-size:27px'>Evaluate the expressions below:</u><br><p style='font-size:23px'><b>1)</b> 8 + 3 =</p>", options: ['5', '11', '12', '24'], required: true},
          {prompt: "<p style='font-size:23px'><b>2)</b> 7 x 6 =</p>", options: ['42', '56', '13', '35'], required: true},
          {prompt: "<p style='font-size:23px'><b>3)</b> 10 / 2 =</p>", options: ['2', '4', '5', '20'], required: true},
          {prompt: "<p style='font-size:23px'><b>4)</b> 24 - 15 =</p>", options: ['39', '17', '7', '9'], required: true},
          {prompt: "<p style='font-size:23px'><b>5)</b> 20 / (4 + 6) =</p>", options: ['5', '2', '8', '10'], required: true},
          {prompt: "<p style='font-size:23px'><b>6)</b> 17 - 2 x 4 =</p>", options: ['11', '60', '9', '8'], required: true}],
        data: {test_part: 'arithmetic_questions'}
      }
      timeline.push(arithmetic_questions);

      let arithmetic_completion = {
        type: "html-keyboard-response",
        stimulus: "<p>You are done with part 1 of the experiment!</p>"+
          "<p>Press the space bar to continue.</p>",
        choices: [' ']
      }
      timeline.push(arithmetic_completion);

      // instructions for video rounds
      let instructions = {
        type: "html-keyboard-response",
        stimulus: "<p>In Part 2 of the experiment, you will be watching a series of videos involving shapes. We will ask you to make some judgments about the movement of the shapes.</p>"+

        // display green and yellow squares
        "<img src='images/green_square.png' width='80' height='80'></img>"+"<nobr><font color='white'>_____</font></nobr>"+
        "<img src='images/yellow_square.jpg' width='80' height='80'></img>"+

        "<p>Press the space bar to continue.</p>",
        choices: [' ']
      }
      timeline.push(instructions);

      // screen right before test begins
      let begin_test = {
        type: "html-keyboard-response",
        stimulus: "<p>After that, you will watch a video that will show the results and answer two more questions about the results.</p>"+"<p>You will use a sliding scale to rate how unexpected the result is.</p>"+"<p>We also ask you to describe the situation in one or two sentences by typing your answer in the box.</p>"+"<br>"+"<p>When you are ready to begin, press the space bar to continue.</p>",
        choices: [' ']
      }
      timeline.push(begin_test);

      // create fixation plus sign
      let fixation = {
        type: 'html-keyboard-response',
        stimulus: '<p style="font-size:200px">+<p>',

        // user cannot press any keys to continue
        choices: jsPsych.NO_KEYS,

        // instead, the user must wait a random amount of time (1-3s)
        trial_duration: function(){
            return jsPsych.randomization.sampleWithoutReplacement([1000, 1250, 1500, 1750, 2000, 2250, 2500, 2750, 3000], 1)[0];
        },
        data: {test_part: 'fixation'}
      }

      // BETA VERSION: Videos split up into two groups with equal category distribution, determined beforehand
      // Video numbers minus 1 (because arrays start at 0 but video names at 1) will be put into large array
      // Depending on even/odd participant id, participant will have first half one style (social or pattern), and second half the other

      let group1_integers = [
        1-1,
        9-1,
        20-1,
        33-1,
        13-1,
        23-1,
        27-1,
        37-1,
        8-1,
        15-1,
        17-1,
        22-1,
        7-1,
        31-1,
        35-1,
        38-1,
        12-1,
        19-1,
        28-1,
        40-1
      ];

      // randomize group 1 order
      let shuffled_group1_integers = shuffle(group1_integers);

      let group2_integers = [
        3-1,
        5-1,
        10-1,
        29-1,
        2-1,
        4-1,
        14-1,
        24-1,
        11-1,
        16-1,
        21-1,
        26-1,
        6-1,
        30-1,
        32-1,
        34-1,
        18-1,
        25-1,
        36-1,
        39-1
      ];

      // randomize group 2 order
      let shuffled_group2_integers = shuffle(group2_integers);

      // combine both arrays together, group 1 always first
      let beta_video_order = shuffled_group1_integers.concat(shuffled_group2_integers);

      // unshuffled list of shortened test video links
      // later converted into full link via make_link() function
      let unshuffled_short_observed = [
        "videos/observed/1_arcs_obs.mp4",
        "videos/observed/2_block_obs.mp4",
        "videos/observed/3_opening_obs.mp4",
        "videos/observed/4_bowtie_obs.mp4",
        "videos/observed/5_boxing_obs.mp4",
        "videos/observed/6_climb_obs.mp4",
        "videos/observed/7_infinity_obs.mp4",
        "videos/observed/8_catching_obs.mp4",
        "videos/observed/9_hideouts_obs.mp4",
        "videos/observed/10_clamshell_obs.mp4",
        "videos/observed/11_square_obs.mp4",
        "videos/observed/12_following_obs.mp4",
        "videos/observed/13_coneweave_obs.mp4",
        "videos/observed/14_zigzag_obs.mp4",
        "videos/observed/15_threeway_obs.mp4",
        "videos/observed/16_triangle_obs.mp4",
        "videos/observed/17_grabbing_obs.mp4",
        "videos/observed/18_mirror_obs.mp4",
        "videos/observed/19_track_obs.mp4",
        "videos/observed/20_hiding_obs.mp4",
        "videos/observed/21_ignoring_obs.mp4",
        "videos/observed/22_knight_obs.mp4",
        "videos/observed/23_maze_obs.mp4",
        "videos/observed/24_meeting_obs.mp4",
        "videos/observed/25_plus_obs.mp4",
        "videos/observed/26_stairs_obs.mp4",
        "videos/observed/27_steps_obs.mp4",
        "videos/observed/28_chasing_obs.mp4",
        "videos/observed/29_points_obs.mp4",
        "videos/observed/30_trapezoid_obs.mp4",
        "videos/observed/31_ricochet_obs.mp4",
        "videos/observed/32_rounding_obs.mp4",
        "videos/observed/33_searching_obs.mp4",
        "videos/observed/34_stalls_obs.mp4",
        "videos/observed/35_parallelogram_obs.mp4",
        "videos/observed/36_touching_obs.mp4",
        "videos/observed/37_peeking_obs.mp4",
        "videos/observed/38_handshake_obs.mp4",
        "videos/observed/39_shortcut_obs.mp4",
        "videos/observed/40_rectangles_obs.mp4",
      ];

      // make array from 1 to n where n is length of observed video list plus 1
      // this will be used to number each trial for .json file
      let video_count = unshuffled_short_observed.length;
      let counting_array = make_counting_array(video_count);

      // essentially just renaming the variable to a more logical name
      // to be used to reorder all videos (observed, pattern, and social) and screenshots
      let shuffled_array = beta_video_order;

      // turn the observed video short links into long links
      let unshuffled_observed = make_link(unshuffled_short_observed);

      // unshuffled list of test video times
      // ~1000 added to video length to compensate for video loading speed
      let unshuffled_observed_time_list = [
        7000,
        7200,
        9500,
        6000,
        6300,
        7000,
        11000,
        5100,
        10000,
        9000,
        11500,
        10200,
        7100,
        6100,
        7000,
        10500,
        7000,
        14500,
        12000,
        6500,
        7000,
        6100,
        7000,
        9300,
        14000,
        6500,
        5200,
        11700,
        6000,
        9500,
        8500,
        13500,
        10500,
        11200,
        9500,
        12500,
        10500,
        14500,
        13500,
        12000
      ];

      // list of screenshots (last frame of the video)
      let unshuffled_screenshot_list = [
        "<img src='editedscreenshots/1_arcs.jpg' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/2_block.PNG' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/3_opening.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/4_bowtie.jpg' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/5_boxing.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/6_climb.PNG' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/7_infinity.PNG' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/8_catching.jpg' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/9_hideouts.PNG' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/10_clamshell.jpg' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/11_square.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/12_following.PNG' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/13_coneweave.jpg' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/14_zigzag.jpg' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/15_threeway.jpg' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/16_triangle.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/17_grabbing.jpg' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/18_mirror.PNG' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/19_track.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/20_hiding.jpg' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/21_ignoring.jpg' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/22_knight.jpg' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/23_maze.jpg' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/24_meeting.jpg' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/25_plus.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/26_stairs.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/27_steps.jpg' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/28_chasing.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/29_points.jpg' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/30_trapezoid.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/31_ricochet.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/32_rounding.PNG' width='490' height='368' border='1'></img>",
        "<img src='editedscreenshots/33_searching.PNG' width='490' height='368' border='1'></img>",
        "<img src='editedscreenshots/34_stalls.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/35_parallelogram.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/36_touching.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/37_peeking.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/38_handshake.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/39_shortcut.png' width='533' height='300' border='1'></img>",
        "<img src='editedscreenshots/40_rectangles.png' width='533' height='300' border='1'></img>",
      ];

      // unshuffled list of shortened pattern feedback videos
      let unshuffled_pattern_short_videos = [
        "videos/pattern/1_arcs_pattern.mp4",
        "videos/pattern/2_block_pattern.mp4",
        "videos/pattern/3_opening_pattern.mp4",
        "videos/pattern/4_bowtie_pattern.mp4",
        "videos/pattern/5_boxing_pattern.mp4",
        "videos/pattern/6_climb_pattern.mp4",
        "videos/pattern/7_infinity_pattern.mp4",
        "videos/pattern/8_catching_pattern.mp4",
        "videos/pattern/9_hideouts_pattern.mp4",
        "videos/pattern/10_clamshell_pattern.mp4",
        "videos/pattern/11_square_pattern.mp4",
        "videos/pattern/12_following_pattern.mp4",
        "videos/pattern/13_coneweave_pattern.mp4",
        "videos/pattern/14_zigzag_pattern.mp4",
        "videos/pattern/15_threeway_pattern.mp4",
        "videos/pattern/16_triangle_pattern.mp4",
        "videos/pattern/17_grabbing_pattern.mp4",
        "videos/pattern/18_mirror_pattern.mp4",
        "videos/pattern/19_track_pattern.mp4",
        "videos/pattern/20_hiding_pattern.mp4",
        "videos/pattern/21_ignoring_pattern.mp4",
        "videos/pattern/22_knight_pattern.mp4",
        "videos/pattern/23_maze_pattern.mp4",
        "videos/pattern/24_meeting_pattern.mp4",
        "videos/pattern/25_plus_pattern.mp4",
        "videos/pattern/26_stairs_pattern.mp4",
        "videos/pattern/27_steps_pattern.mp4",
        "videos/pattern/28_chasing_pattern.mp4",
        "videos/pattern/29_points_pattern.mp4",
        "videos/pattern/30_trapezoid_pattern.mp4",
        "videos/pattern/31_ricochet_pattern.mp4",
        "videos/pattern/32_rounding_pattern.mp4",
        "videos/pattern/33_searching_pattern.mp4",
        "videos/pattern/34_stalls_pattern.mp4",
        "videos/pattern/35_parallelogram_pattern.mp4",
        "videos/pattern/36_touching_pattern.mp4",
        "videos/pattern/37_peeking_pattern.mp4",
        "videos/pattern/38_handshake_pattern.mp4",
        "videos/pattern/39_shortcut_pattern.mp4",
        "videos/pattern/40_rectangles_pattern.mp4",
      ];

      // turn the pattern feedback short links into long links
      let unshuffled_pattern_feedback_videos = make_link(unshuffled_pattern_short_videos);

      // unshuffled list of pattern feedback video times
      // ~1000 added to video length to compensate for video loading speed
      let unshuffled_pf_time_list = [
        5500,
        4500,
        5500,
        8300,
        6000,
        5500,
        6000,
        4500,
        6500,
        7500,
        6000,
        6000,
        6500,
        6500,
        5500,
        6500,
        3000,
        6500,
        6000,
        5000,
        4000,
        4000,
        6000,
        5000,
        6200,
        5500,
        3000,
        5800,
        6000,
        6500,
        5500,
        9000,
        6000,
        6300,
        6000,
        5800,
        6500,
        7000,
        7000,
        6500
      ];

      // unshuffled list of shortened social feedback video links
      let unshuffled_social_short_videos = [
        "videos/social/1_arcs_social.mp4",
        "videos/social/2_block_social.mp4",
        "videos/social/3_opening_social.mp4",
        "videos/social/4_bowtie_social.mp4",
        "videos/social/5_boxing_social.mp4",
        "videos/social/6_climb_social.mp4",
        "videos/social/7_infinity_social.mp4",
        "videos/social/8_catching_social.mp4",
        "videos/social/9_hideouts_social.mp4",
        "videos/social/10_clamshell_social.mp4",
        "videos/social/11_square_social.mp4",
        "videos/social/12_following_social.mp4",
        "videos/social/13_coneweave_social.mp4",
        "videos/social/14_zigzag_social.mp4",
        "videos/social/15_threeway_social.mp4",
        "videos/social/16_triangle_social.mp4",
        "videos/social/17_grabbing_social.mp4",
        "videos/social/18_mirror_social.mp4",
        "videos/social/19_track_social.mp4",
        "videos/social/20_hiding_social.mp4",
        "videos/social/21_ignoring_social.mp4",
        "videos/social/22_knight_social.mp4",
        "videos/social/23_maze_social.mp4",
        "videos/social/24_meeting_social.mp4",
        "videos/social/25_plus_social.mp4",
        "videos/social/26_stairs_social.mp4",
        "videos/social/27_steps_social.mp4",
        "videos/social/28_chasing_social.mp4",
        "videos/social/29_points_social.mp4",
        "videos/social/30_trapezoid_social.mp4",
        "videos/social/31_ricochet_social.mp4",
        "videos/social/32_rounding_social.mp4",
        "videos/social/33_searching_social.mp4",
        "videos/social/34_stalls_social.mp4",
        "videos/social/35_parallelogram_social.mp4",
        "videos/social/36_touching_social.mp4",
        "videos/social/37_peeking_social.mp4",
        "videos/social/38_handshake_social.mp4",
        "videos/social/39_shortcut_social.mp4",
        "videos/social/40_rectangles_social.mp4",
      ];

      // turn social feedback short links into long links
      let unshuffled_social_feedback_videos = make_link(unshuffled_social_short_videos);

      // unshuffled list of social feedback video times
      // ~1000 added to video length to compensate for video loading speed
      let unshuffled_sf_time_list = [
        5000,
        3000,
        4500,
        2500,
        4500,
        5000,
        6500,
        2500,
        7500,
        5500,
        4250,
        5000,
        2500,
        2500,
        2500,
        5000,
        2500,
        4500,
        5800,
        2500,
        3500,
        2500,
        3500,
        2500,
        5000,
        5000,
        2000,
        6300,
        5000,
        6500,
        5000,
        4500,
        3500,
        6300,
        6000,
        5000,
        5500,
        7000,
        7000,
        6500
      ];

      // calls match_with_array function
      // shuffles all of the test arrays according to the shuffled array of integers
      // they can't each be shuffled differently because the videos still need to correspond to one another
      let observed_videos = match_with_array(shuffled_array, unshuffled_observed);
      let observed_time_list = match_with_array(shuffled_array, unshuffled_observed_time_list);
      let screenshot_list = match_with_array(shuffled_array, unshuffled_screenshot_list);
      let pattern_feedback_videos = match_with_array(shuffled_array, unshuffled_pattern_feedback_videos);
      let pf_time_list = match_with_array(shuffled_array, unshuffled_pf_time_list);
      let social_feedback_videos = match_with_array(shuffled_array, unshuffled_social_feedback_videos);
      let sf_time_list = match_with_array(shuffled_array, unshuffled_sf_time_list);

      // these three calls shuffle the SHORTENED links - this is necessary for the experiment_data() function for readability
      let shuffled_short_observed = match_with_array(shuffled_array, unshuffled_short_observed);
      let shuffled_pattern_short_videos = match_with_array(shuffled_array, unshuffled_pattern_short_videos);
      let shuffled_social_short_videos = match_with_array(shuffled_array, unshuffled_social_short_videos);

      // array of options/answers to multiple choice question, used for both practice and actual
      let question_options = ['up', 'down', 'left', 'right', 'other'];

      // confidence slider
      let confidence = {
        type: "html-slider-response",
        stimulus: "How confident are you in your prediction?",

        // labels the slider
        labels: ["not at all confident", "very confident"],
        slider_width: 8000,
        data: {test_part: 'confidence'}
      }

      // participant explains their rationale behind their prediction
      let prediction_rationale = {
        type: "survey-text",
        questions: [{prompt: "Why did you make this prediction?", required:true, rows:8, columns:60}],
        data: {test_part: 'prediction_rationale'}
      }

      // cue feedback video
      let feedback_cue = {
        type: 'html-keyboard-response',
        stimulus: "<p style='font-size:30px'><b>Here is the results video:</b></p>"+"<br><br><br><br><br>",
        // user cannot press any keys to continue
        choices: jsPsych.NO_KEYS,
        trial_duration: 2000
      }

      // rate level of surprise using a slider
      let expectation_slider = {
        type: "html-slider-response",
        stimulus: "How expected was that outcome?",

        // labels the slider
        labels: ["not at all expected", "very expected"],
        slider_width: 8000,
        data: {test_part: 'expectation_slider'}
      }

      // free response question to explain level of surprise
      let situation_rationale = {
        type: "survey-text",
        questions: [{prompt: "What do you think the situation was?", rows:8, columns:60, required:true}],
        data: {test_part: 'situation_rationale'}
      }

      // initialize variable so that it can be a parameter for create_trials()
      let next_video_cue;

      // call create_trials() function
      let test_procedure = create_trials(
        observed_videos,
        pattern_feedback_videos,
        social_feedback_videos,
        screenshot_list,
        confidence,
        prediction_rationale,
        feedback_cue,
        expectation_slider,
        situation_rationale,
        next_video_cue,
        observed_time_list,
        fixation,
        pf_time_list,
        sf_time_list,
      );

      // put nested timeline into big timeline
      let test_trials = {
        timeline: test_procedure
      }
      timeline.push(test_trials);

      // end screen
      let end_screen = {
        type: "html-keyboard-response",
        stimulus: function finish_task() {

          // retrieve the generated user id
          let id = JSON.stringify(six_digit_random);

          // send data to s3 bucket
          send_data(id);

          return "<p>You have now finished the second part of the experiment!</p>"+
            "<p>Please go to the following page to complete some surveys:</p>"+"<a href='https://neu.co1.qualtrics.com/jfe/form/SV_0PyNVw2TxNfTEep'>https://neu.co1.qualtrics.com/jfe/form/SV_0PyNVw2TxNfTEep</a>";
        },
        choices: jsPsych.NO_KEYS
      }
      timeline.push(end_screen);

      // initialize the big timeline
      jsPsych.init({
        timeline: timeline,

        // when big timeline ends, perform these operations
        on_finish: function(data){

          jsPsych.data.displayData();
        }
      });

      // method create nested timeline for the test part
      function create_trials(
        observed_videos,
        pattern_feedback_videos,
        social_feedback_videos,
        screenshot_list,
        confidence,
        prediction_rationale,
        feedback_cue,
        expectation_slider,
        situation_rationale,
        next_video_cue,
        observed_time_list,
        fixation,
        pf_time_list,
        sf_time_list) {

        // define nested timeline
        let logistics_timeline = [];

        // for each observed video, append objects created at the top, in order
        for (let i = 0; i < observed_videos.length; i++) {

          // put fixation, social video, and multiple choice question in timeline
          logistics_timeline.push(fixation);

          // put observed video in timeline as an object
          let video_object = {
            type: "html-keyboard-response",

            // take link with index "i" from the list of shuffled observed links
            stimulus: observed_videos[i],
            choices: jsPsych.NO_KEYS,

            // take timestamp with index "i" from the observed_time_list
            trial_duration: observed_time_list[i],
            data: {test_part: 'video_url'}
          }
          logistics_timeline.push(video_object);

          // create multiple choice test question object
          let question = {
            type: "survey-multi-choice",
            questions: [{prompt: screenshot_list[i]+"<p>Which direction do you predict the <font color='MediumSeaGreen'>GREEN</font> square will move next?</p>", options: question_options, required: true, horizontal:true}],
            data: {test_part: 'question'}
          }
          logistics_timeline.push(question);

          // determine whether participant selected "other," and if yes, prompt user with text box
          let other = {
            type: function type() {

              // we need to get the value of previous MC question
              // in order to do this, we find the length and use that as the index for the array of responses
              let length = jsPsych.data.get().filter({test_part: 'question'}).select('responses').values.length;
              let multiple_choice_response = jsPsych.data.get().filter({test_part: 'question'}).select('responses').values[length-1];

              // return prompt if participant selected "other," return 1 millisecond blank screen if not
              if (multiple_choice_response == '{"Q0":"other"}') {
                return 'survey-text';
              }
              return 'html-keyboard-response';
            },
            stimulus: ' ',

            // display prompt if "other" was selected, return nothing if not
            // this key will be ignored if it has no value
            questions: function question() {
              let length = jsPsych.data.get().filter({test_part: 'question'}).select('responses').values.length;
              let multiple_choice_response = jsPsych.data.get().filter({test_part: 'question'}).select('responses').values[length-1];
              if (multiple_choice_response == '{"Q0":"other"}') {
                return [{prompt: "Other:", rows:6, columns:50, required:true}];
              }
            },

            // store the data
            data: function testpart() {
              let length = jsPsych.data.get().filter({test_part: 'question'}).select('responses').values.length;
              let multiple_choice_response = jsPsych.data.get().filter({test_part: 'question'}).select('responses').values[length-1];

              // if the type of test is a survey-text ("other" was picked the question prior)
              // create a key for the trial called test_part
              // since the user's response to the survey_text will automatically be logged in "responses", we don't worry about making a responses: key
              if (multiple_choice_response == '{"Q0":"other"}') {
                return {test_part: 'other'};
              }

              // if the type of test is an html-keyboard-response ("other" was NOT picked the question prior)
              // create two keys, since the "responses" key is not a given key in html-keyboard-response trials
              // therefore we have to make it ourself
              // this is important because later we will be looking for the value "responses" key when gathering data
              return {test_part: 'other', responses: 'not an "other"'};
            },

            // if html-keyboard-response, the blank screen will last for 1 millisecond
            // if survey-text, this key will be ignored
            trial_duration: 1
          }
          logistics_timeline.push(other);

          // put confidence level slider in timeline
          logistics_timeline.push(confidence);

          // put prediction rationale prompt in timeline
          logistics_timeline.push(prediction_rationale);

          // put cue feedback video in timeline
          logistics_timeline.push(feedback_cue);

          // if participant number is even and video is from group 1, show social feedback video
          // if participant number is odd and video is from group 2, show social feedback video
          if ((isEven(six_digit_random) == true && i < unshuffled_short_observed.length/2) || (isEven(six_digit_random) != true && i >= unshuffled_short_observed.length/2)) {

            // put feedback video in timeline
            let feedback_object = {
              type: "html-keyboard-response",

              // take social feedback video with index "i" from social_feedback_videos list
              stimulus: social_feedback_videos[i],
              choices: jsPsych.NO_KEYS,

              // take social feedback video timestamps with index "i" from sf_time_list
              trial_duration: sf_time_list[i],
              data: {test_part:'feedback_url'}
            }
            logistics_timeline.push(feedback_object);
          }

          // for any other combination, show pattern feedback video
          else {

            let feedback_object = {
              type: "html-keyboard-response",

              // take pattern feedback video with index "i" from pattern_feedback_videos list
              stimulus: pattern_feedback_videos[i],
              choices: jsPsych.NO_KEYS,

              // take physical feedback video timestamps with index "i" from sf_time_list
              trial_duration: pf_time_list[i],
              data: {test_part:'feedback_url'}
            }
            logistics_timeline.push(feedback_object);
          }

          // put expectation level slider in timeline
          logistics_timeline.push(expectation_slider);

          // put situation_rationale in timeline
          logistics_timeline.push(situation_rationale);

          // cue for next video, EXCEPT after last video
          next_video_cue = {
            type: 'html-keyboard-response',
            stimulus: "Next video "+"("+(i+2)+" of "+unshuffled_short_observed.length+")"+
              "<p>Press the space bar when you are ready</p>",
            choices: [' ']
          }

          if (i != (observed_videos.length-1)) {
            logistics_timeline.push(next_video_cue);
          }
        }
        return logistics_timeline;
      }

      // function that makes and combines numerous JSON objects into a list (using data)
      function experiment_data() {

        // note whether participant scored perfectly on arithmetic section
        let arithmetic_perfection = "no";
        if (jsPsych.data.get().filter({test_part: 'arithmetic_questions'}).select('responses').values[0] == '{"Q0":"11","Q1":"42","Q2":"5","Q3":"9","Q4":"2","Q5":"9"}') {
          arithmetic_perfection = "yes";
        }

        // define timeline of JSON objects
        let trial_timeline = [];

        // determine the feedback video order
        let order = "unknown";
        if (isEven(six_digit_random) == true) {
          order = "social first, pattern second";
        }
        else {
          order = "pattern first, social second";
        }

        // add this info to the start of .JSON file
        let arithmetic_data = {
          "participant_id": JSON.stringify(six_digit_random),
          "arithmetic_responses": jsPsych.data.get().filter({test_part: 'arithmetic_questions'}).select('responses').values[0],
          "perfect_arithmetic_score": arithmetic_perfection,
          "feedback_order": order
        }
        trial_timeline.push(arithmetic_data);

        for (let i = 0; i < observed_videos.length; i++) {
          let json = {

            // for each of these keys we are selecting all of the data for that particular observed video
            // jsPsych.data.get() gets all of the data from the experiment
            // .filter() filters the data so that it will only return trials that are part of the certain "test_part", returning an array of JSON obj
            // .select() selects the particular key within the trials
            // .values gets the value of the corresponding key in an array, so the [i] is needed
            "trial_number": counting_array[i],
            "video_url": shuffled_short_observed[i],
            "answer_to_question":jsPsych.data.get().filter({test_part: 'question'}).select('responses').values[i],
            "other_response": jsPsych.data.get().filter({test_part: 'other'}).select('responses').values[i],
            "confidence_slider_value":jsPsych.data.get().filter({test_part: 'confidence'}).select('response').values[i],

            // calls function that returns either the shuffled social or pattern SHORT arrays, depending on randomization1
            "feedback_url": social_or_pattern(i),

            "prediction_rationale":jsPsych.data.get().filter({test_part: 'prediction_rationale'}).select('responses').values[i],
            "expectation_slider_value":jsPsych.data.get().filter({test_part: 'expectation_slider'}).select('response').values[i],
            "situation_rationale":jsPsych.data.get().filter({test_part: 'situation_rationale'}).select('responses').values[i]
          }
          trial_timeline.push(json);
        }

        return trial_timeline;
      }

      // returns feedback url for each trial
      function social_or_pattern(i) {
        if ((isEven(six_digit_random) == true && i < unshuffled_short_observed.length/2) || (isEven(six_digit_random) != true && i >= unshuffled_short_observed.length/2)) {
          return shuffled_social_short_videos[i];
        }
        else {
          return shuffled_pattern_short_videos[i];
        }
      }

      // this method takes an array and shuffles it randomly
      // link to original post: https://github.com/Daplie/knuth-shuffle/blob/master/index.js
      function make_counting_array(count) {
        let new_array = [];

        // start at i = 1 so that trial number displayed on .JSON file doesn't start with 0
        for (let i = 1; i < (count+1); i++) {
          new_array.push(i);
        }
        return new_array;
      }

      // shuffle array randomly
      function shuffle(array) {
        let currentIndex = array.length, temporaryValue, randomIndex;

        // While there remain elements to shuffle...
        while (0 !== currentIndex) {

          // Pick a remaining element...
          randomIndex = Math.floor(Math.random() * currentIndex);
          currentIndex -= 1;

          // And swap it with the current element.
          temporaryValue = array[currentIndex];
          array[currentIndex] = array[randomIndex];
          array[randomIndex] = temporaryValue;
        }
        return array;
      }

      // turn abbreviated links into machine-readable ones
      function make_link(array) {
        let new_array = [];
        let part_1 = "<div style='border:1px solid black;'><video src="
        let part_2 = " width='533' height='300' autoplay='1'>Error: your browser does not support this!</video></div>"+"<hr style='height:115px; visibility:hidden;' />"

        for (let i = 0; i < array.length; i++) {

          let combined = part_1 + array[i] + part_2;
          new_array.push(combined);
        }
        return new_array;
      }

      // take in the shuffled array of integers and second array of the same length
      // shuffle the second array based on the order of that shuffled array of integers
      function match_with_array(shuffled_array, substance_array) {
        let new_array = [];

        for (let i = 0; i < shuffled_array.length; i++) {

          // for each index in the shuffled array of integers, set its corresponding integral value to shuffled_value
          let shuffled_value = shuffled_array[i];

          // that integer will become the index for the value we will append to the new array
          new_array.push(substance_array[shuffled_value]);
        }
        return new_array;
      }

      // sends the user's data to the S3 bucket
      function send_data(id) {

        // define new XML Http request
        let xhr = new XMLHttpRequest();

        // (method, url, asynchronous(y/n))
        xhr.open("POST", "https://tyg3lxdvqj.execute-api.us-east-1.amazonaws.com/beta/socialpredictionapi", true);
        xhr.setRequestHeader('Content-Type', "application/x-www-form-urlencoded; charset=UTF-8");

        // JSON.stringify turns a non-string into a string so that it can be sent to the bucket
        xhr.send(JSON.stringify({
          "data":JSON.stringify(experiment_data()),

          // id is already a string so it does not need JSON.stringify
          "participant_id":id
        }));
      }

      // used to generate unique 6 digit id
      // potential issue: does NOT prevent two identical numbers from being generated, although the odds of this are extremely low
      function six_digit_random() {
        let number = 0;
        while (number < 100000) {
          number = Math.floor((Math.random() * 999999));
        }
        return number;
      }

      function isEven(num) {
        return num % 2 === 0;
      }

    </script>
</html>
